{{ define "main" }}
<div style="text-align: center; margin-bottom: 2rem; padding: 2rem; background: linear-gradient(135deg, #f5f2ed 0%, #e5ddd3 100%); border-radius: 8px;">
  <h1 style="border: none; color: #5a4a3a; margin: 0;">{{ .Title }}</h1>
  <p style="font-size: 1.1rem; color: #7d6c5a; margin-top: 1rem;">{{ .Content }}</p>
</div>

{{ $photos := where site.RegularPages "Section" "photograph" }}
{{ if gt (len $photos) 0 }}
<div class="content-section" style="margin-bottom: 3rem;">
  <h2>ğŸ“¸ Historical Photographs</h2>
  <div id="photo-gallery" style="position: relative; height: 400px; background: #f5f2ed; border-radius: 8px; overflow: hidden; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
    {{ range $photos }}
      {{ if .Params.image }}
      <div class="gallery-slide" data-image="{{ .Params.image }}" style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; transition: opacity 1s ease-in-out;">
        <a href="{{ .RelPermalink }}" style="display: block; width: 100%; height: 100%; position: relative; border: none;">
          <img data-src="{{ .Params.image }}" alt="{{ .Title }}" style="width: 100%; height: 100%; object-fit: cover; background: #e5ddd3;">
          <div style="position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.8)); padding: 2rem 1rem 1rem; color: #f9f7f4;">
            <h3 style="color: #f9f7f4; margin: 0 0 0.5rem 0; font-size: 1.3rem; border: none;">{{ .Title }}</h3>
            {{ if .Params.photo_date }}<p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">{{ .Params.photo_date }}</p>{{ end }}
          </div>
        </a>
      </div>
      {{ end }}
    {{ end }}
    <button id="prev-photo" style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.5rem; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">â€¹</button>
    <button id="next-photo" style="position: absolute; right: 1rem; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; font-size: 1.5rem; z-index: 10; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">â€º</button>
  </div>
  <p style="text-align: right; margin-top: 1rem;"><a href="/photograph/">View all photographs â†’</a></p>
</div>
{{ end }}

<div class="content-section">
  <h2>ğŸ“œ Random Records</h2>
  <p style="font-style: italic; color: #7d6c5a;">Glimpses into the village's past... ({{ len (where site.RegularPages "Section" "records") }} records total)</p>
  <ul id="records-list" style="list-style: none; margin-left: 0;">
    {{ range (where site.RegularPages "Section" "records") }}
      {{ if ne .Params.record_type "announcement" }}
      <li style="display: none; padding: 0.75rem; margin-bottom: 0.5rem; background: #f9f7f4; border-left: 3px solid #8b7355; border-radius: 4px;">
        <a href="{{ .RelPermalink }}" style="border: none; font-weight: bold;">{{ .Title }}</a>
        {{ with .Date }}<span class="date"> â€“ {{ .Format "2 January 2006" }}</span>{{ end }}
        {{ with .Params.dateAdded }}<span style="font-size: 0.85rem; color: #999; margin-left: 0.5rem;">(Added {{ . }})</span>{{ end }}
      </li>
      {{ end }}
    {{ end }}
  </ul>
  <p style="text-align: right; margin-top: 1rem;"><a href="/records/">View all records â†’</a></p>
</div>

<div class="content-section">
  <h2>ğŸ“Š Census Records</h2>
  <p style="font-style: italic; color: #7d6c5a;">Browse census records by year.</p>
  <p style="text-align: right; margin-top: 1rem;"><a href="/census/">View census records â†’</a></p>
</div>

<div class="content-section">
  <h2>ğŸ“– Trade Directories</h2>
  <p style="font-style: italic; color: #7d6c5a;">Historical directory excerpts listing people working in the village during different periods.</p>
  <ul id="trade-directory-list">
    {{ range (where site.RegularPages "Section" "trade-directory") }}
      {{ if .Title }}
        <li style="display: none;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
      {{ end }}
    {{ end }}
  </ul>
  <p style="text-align: right; margin-top: 1rem;"><a href="/trade-directory/">View all trade directories â†’</a></p>
</div>

<div class="content-section">
  <h2>ğŸ™ï¸ Interviews</h2>
  <p style="font-style: italic; color: #7d6c5a;">Primary research interviews with people living in or connected to the village.</p>
  <ul id="interviews-list">
    {{ range (where site.RegularPages "Section" "interview") }}
      {{ if .Title }}
        <li style="display: none;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
      {{ end }}
    {{ end }}
  </ul>
  <p style="text-align: right; margin-top: 1rem;"><a href="/interview/">View all interviews â†’</a></p>
</div>

<hr>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin: 2rem 0;">
  
  <div class="content-section">
    <h2>ğŸ›ï¸ Buildings</h2>
    <ul id="buildings-list">
      {{ range (where site.RegularPages "Section" "building") }}
        {{ if .Title }}
          <li style="display: none;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
        {{ end }}
      {{ end }}
    </ul>
    <p style="text-align: right; margin-top: 1rem;"><a href="/building/">View all buildings â†’</a></p>
  </div>

  <div class="content-section">
    <h2>ğŸ¢ Institutions</h2>
    <ul id="institutions-list">
      {{ range (where site.RegularPages "Section" "institution") }}
        {{ if .Title }}
          <li style="display: none;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
        {{ end }}
      {{ end }}
    </ul>
    <p style="text-align: right; margin-top: 1rem;"><a href="/institution/">View all institutions â†’</a></p>
  </div>

  <div class="content-section">
    <h2>ğŸ‘¤ Residents</h2>
    <ul id="residents-list">
      {{ range (where site.RegularPages "Section" "resident") }}
        {{ if .Title }}
          <li style="display: none;"><a href="{{ .RelPermalink }}">{{ .Title }}</a></li>
        {{ end }}
      {{ end }}
    </ul>
    <p style="text-align: right; margin-top: 1rem;"><a href="/resident/">View all residents â†’</a></p>
  </div>
  
</div>

<script>
// Shuffle and show random items from list
function showRandomItems(listId, count) {
  const ul = document.getElementById(listId);
  if (!ul) return;
  
  const items = Array.from(ul.children);
  
  // Fisher-Yates shuffle
  for (let i = items.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [items[i], items[j]] = [items[j], items[i]];
  }
  
  // Clear the list
  ul.innerHTML = '';
  
  // Show first 'count' items from shuffled array
  const itemsToShow = items.slice(0, Math.min(count, items.length));
  itemsToShow.forEach(item => {
    item.style.display = '';
    ul.appendChild(item);
  });
}

// Show random items on page load
document.addEventListener('DOMContentLoaded', function() {
  showRandomItems('records-list', 10);
  showRandomItems('trade-directory-list', 5);
  showRandomItems('interviews-list', 5);
  showRandomItems('buildings-list', 8);
  showRandomItems('institutions-list', 8);
  showRandomItems('residents-list', 8);

  // Photo gallery rotation with lazy loading
  const gallery = document.getElementById('photo-gallery');
  if (gallery) {
    const slides = gallery.querySelectorAll('.gallery-slide');
    let currentSlide = 0;
    const loadedImages = new Set();

    // Lazy load image
    function loadImage(index) {
      if (loadedImages.has(index) || index < 0 || index >= slides.length) return;

      const slide = slides[index];
      const img = slide.querySelector('img');
      const src = img.getAttribute('data-src');

      if (src && !img.src) {
        img.src = src;
        loadedImages.add(index);
      }
    }

    // Preload adjacent images
    function preloadAdjacent(index) {
      const nextIndex = (index + 1) % slides.length;
      const prevIndex = (index - 1 + slides.length) % slides.length;
      loadImage(nextIndex);
      loadImage(prevIndex);
    }

    function showSlide(index) {
      // Load current image
      loadImage(index);

      // Show/hide slides
      slides.forEach((slide, i) => {
        if (i === index) {
          slide.style.display = 'block';
          setTimeout(() => slide.style.opacity = '1', 50);
        } else {
          slide.style.opacity = '0';
          setTimeout(() => slide.style.display = 'none', 1000);
        }
      });

      // Preload adjacent images after showing current one
      setTimeout(() => preloadAdjacent(index), 100);
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(currentSlide);
    }

    // Show first slide
    if (slides.length > 0) {
      showSlide(0);

      // Auto-rotate every 5 seconds
      setInterval(nextSlide, 5000);

      // Navigation buttons
      const nextBtn = document.getElementById('next-photo');
      const prevBtn = document.getElementById('prev-photo');
      if (nextBtn) nextBtn.addEventListener('click', nextSlide);
      if (prevBtn) prevBtn.addEventListener('click', prevSlide);
    }
  }
});
</script>
{{ end }}
